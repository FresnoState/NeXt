<% if current_user %>
<%= button_to 'Propose Idea',
              new_idea_url,
              method: 'get',
              class: 'btn btn-warning btn-block',
              form_class: 'button_to pull-right' %>
<% end %>

<h2>Ideas</h2>

<%= will_paginate @ideas %>

<div class="list-group">
<% @ideas.each do |idea| %>
  <a class="list-group-item" href="<%= idea_url(idea) %>">
    <div class="row">
      <div class="col-sm-10">
        <h4><%= idea.name %></h4>
        <%= raw idea.pitch %>
        <p><small>
          Proposed
          <% if idea.idea_roles.founders.count > 0 %>
          by <strong><%= idea.idea_roles.founders.includes(:user).map(){ |r| r.user.display_name }.to_sentence %></strong>
          <% end %>
          on <strong><%= idea.created_at.strftime("%B %d, %Y") %></strong>
          <br>
          <em>Supported by <%= idea.idea_votes.count %> ( <%= idea.idea_votes.where(participate: true).count %> would participate )</em>
        </small></p>
      </div>
      <nav class="col-sm-2">
        <div class="visible-md-block visible-lg-block text-right">
          <% unless idea.has_been_voted_for_by? current_user %>
          <%= button_to '+1', '#', class: 'btn btn-success vote', method: 'get' %>
          <% end %>
        </div>
        <div class="hidden-md hidden-lg">
          <% unless idea.has_been_voted_for_by? current_user %>
            <%= button_to '+1', '#', class: 'btn btn-success vote', method: 'get' %>
          <% end %>
        </div>
      </nav>
    </div>
  </a>
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel"><%= idea.name %></h4>
        </div>
        <div class="modal-body">
          <%= button_to 'I think this is a good idea',
                        idea_votes_url(idea),
                        method: :post,
                        params: { participate: false, return_to: ideas_url },
                        class: 'btn btn-block btn-info',
                        form_class: 'button_to full-width' %>
          <%= button_to 'I would participate if this were a project',
                        idea_votes_url(idea),
                        method: :post,
                        params: { participate: true, return_to: ideas_url },
                        class: 'btn btn-block btn-success',
                        form_class: 'button_to full-width' %>
          <%= button_to 'I want to learn more about this',
                        idea_url(idea),
                        class: 'btn btn-block btn-primary',
                        method: 'get',
                        form_class: 'button_to full-width' %>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-block" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
<% end %>
</div>

<%= will_paginate @ideas %>

<script type="text/javascript">
  $('input.vote').click(function(e){
    e.preventDefault();
    $(this).closest('a').next('.modal').modal('show');
  });
</script>
